<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css" />
        <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
        <script type="text/javascript" src="view-source:http://www.openrouteservice.org/js/namespaces.js"></script>
        <script src='js/xml2json.js'></script>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js'></script>

        <script type="text/javascript" src="js/spin.min.js"></script>
        <script type="text/javascript" src="js/leaflet.spin.min.js"></script>
        <style>
            body {
                padding: 0;
                margin: 0;
            }
            html, body, #map {
                height: 100%;
                width: 100%;
            }
        </style>
        <title></title>
    </head>
    <body>
        <div id="map">
        </div>
        <script>
        var map = L.map('map').setView([45.024, -93.305], 10);
        map.attributionControl.addAttribution('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a>');
        var basemap0 = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors,<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
            maxZoom: 14
        });
        basemap0.addTo(map);

        //create
        function onEachFeature(feature, layer) {
            // does this feature have a property named popupContent?
            if (feature.properties) {
                layer.bindPopup("Time: " + feature.properties.time + "<hr>Area: " + feature.properties.area);
            }
        }
        url='https://matrix.mapzen.com/isochrone?api_key=mapzen-RjV32c8&json={"locations":[{"lat":"45.06675586341758","lon":"-93.40384721616283"}],"costing":"auto","denoise":0.3,"polygons":true,"generalize":50,"costing_options":{"pedestrian":{"use_ferry":0}},"contours":[{"time":8},{"time":12},{"time":16},{"time":20}]}';
        function onMapClick(e) {

            alert("You clicked the map at " + e.latlng);
          //  map.spin(true);
          //construct URL here
          //  String(e.latlng.lng)
                  //  String(e.latlng.lng)

            $.ajax({
                type: "GET",
                url: url,
                jsonp: "callback",
                success: function(geojson){
                  console.log(geojson);
                    var marker = L.marker((e.latlng)).addTo(map);


                    var drivetimes = L.geoJson(geojson,{
                        //onEachFeature:onEachNewBranch
                    });
                    drivetimes.addTo(map);
                  //  map.spin(false);
                }
            })

        }

        map.on('click', onMapClick);
        </script>
    </body>
</html>
